<!DOCTYPE html>
<html lang="en">
  <%- include("partials/admin-header") %>

  <body class="nav-md">
    <div class="container body">
      <div class="main_container">
        <!-- sidebar -->
        <%- include("partials/admin-sidebar") %>
        <!-- /sidebar -->

        <!-- top navigation -->
        <%- include("partials/admin-navbar") %>
        <!-- /top navigation -->

        <!-- page content -->
        <div class="right_col" role="main">
          <div class="x_panel">
            <div class="">
              <h2>Quản lý khách hàng</h2>
            </div>

            <div class="h_content">
              <div class="form-group form-inline">
                <div class="col-sm-4">
                  <input type="text" name="" class="form-control left" id="search-text" placeholder="Tên khách hàng" />
                </div>
                <div class="col-sm-4">
                  <button id="search_btn" type="button" class="btn btn-primary left">
                    <i class="fa fa-search"></i>
                  </button>
                </div>
              </div>
            </div>

            <div class="col-md-12 col-sm-12">
              <table class="table_e text-center" >
                <thead>
                  <tr>
                    <th>STT</th>
                    <th>Tên khách hàng</th>
                    <th>Email</th>
                    <th>Trạng thái</th>                    
                  </tr>
                </thead>
                <tbody>
                  <%if (user.role_id===2) {
                  for(var i = 0; i < customers.length; i++) { %>
                  <tr >
                    <td style="padding: 10px 0;"><%- i + 1 %></td>
                    <td>
                      <div><%- customers[i].full_name %></div>
                    </td>
                    <td>
                      <div><%- customers[i].email %></div>
                    </td>                    
                    
                    <td>
                      <% if (customers[i].active===true){ %>
                        <button class="active-btn " style="
                          background-color: aqua; 
                          border-radius: 5px; border: 1px solid #ccc; 
                          padding: 5px ; opacity: 0.5;">Active</button>
                        <button class="block-btn " style="
                          background-color: red; 
                          border-radius: 5px; 
                          border: 1px solid #ccc; 
                          padding: 5px ;" 
                          onclick="blockOrActive('<%- customers[i]._id %>', '<%- customers[i].full_name %>','block')"
                          >Block</button>
                      <% } else { %>
                        <button class="active-btn "style="
                          background-color: aqua; 
                          border-radius: 5px; 
                          border: 1px solid #ccc; 
                          padding: 5px ;"  
                          onclick="blockOrActive('<%- customers[i]._id %>', '<%- customers[i].full_name %>','active')"
                          >Active</button>
                        <button class="block-btn" style="
                          background-color: red; 
                          border-radius: 5px; 
                          border: 1px solid #ccc; 
                          padding: 5px ; opacity: 0.5;">Block</button>
                      <%} %>
                     
                    </td>
                  </tr>
                  <% }} else if (user.role_id===1){ 
                   customers.forEach((customer,index)=>{ %>
                    <tr id="file">
                      <td><%- index+1 %></td>
                      <td><a href="#"><%- customer.full_name %></a></td>
                      <td><%- customer.email %></td>
                      <% if (customer.active ) { %>
                        <td>active</td>
                      <% } else{ %>
                        <td>block</td>
                      <%}%> %>
                      <td class="text-center">
                        <a href="">
                          <button type="button" class="right js-add-up">
                            <i class="fa fa-eye"></i>
                          </button>
                        </a>
                      </td>                      
                      
                    </tr>
                  <% })} %> 
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- /page content -->

        
        <!-- footer content -->
        <%- include("partials/admin-footer") %>
        <!-- /footer content -->
      </div>
    </div>

    <%- include("partials/admin-scripts") %>
    <script>
      const role='<%- user.role_id %>';
      async function blockOrActive(userId,userName,mes){
        const agree=confirm(`Bạn chắc chắn muốn ${mes} đối với ${userName}`);
        if (agree){
          const res=await fetch(`/admin/manage/${userId}?m=${mes}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },          
          });
          const data= await res.json();
          if (data==='done'){
            location.reload();
          }
        }
      }
      const searchBtn=document.querySelector("#search_btn");
      searchBtn.onclick=()=>{
        const search=document.querySelector("#search-text").value;
        if (role==='2')
          location.href=`/admin/customers?search=${search}`;
        else if (role==='1')
        location.href=`/employee/customers?search=${search}`;
      }
      

        
    </script>

  </body>
</html>
